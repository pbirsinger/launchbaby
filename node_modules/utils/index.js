var mongoose = require('mongoose');
var webpage = require('../../models/webpage.js');
var Webpage = mongoose.model('Webpage');

// Should replace most of these functions with a library..

var getBaseUrl = function(url){
  var match = /^http(s)?:\/\/(www\.)?([^\/\?#]+)[\/\?#]*/.exec(url);
  return match ? match[3] : null;
};

exports.parsePageNum = function(url){
	var baseUrl = getBaseUrl(url);
  // ideally want to do with a mongoose promise, or async library
  // by looking in webpage model what the pgQueryParam is
  if (baseUrl != "nytimes.com") return 1;
  var match = /pagewanted=([0-9]+)/.exec(url)
  return match ? match[1] : 1;
}

exports.sanitizeUrl = function(url){
  var match = /^(http(s)?:\/\/[^\?#]+)[\?#]*/.exec(url);
  return match ? match[1] : null;
}
