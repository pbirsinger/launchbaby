var mongoose = require('mongoose');
var webpage = require('../../models/webpage.js');
var Webpage = mongoose.model('Webpage');

// Should replace these functions with a library..

var getBaseUrl = function(url){
  var match = /^http(s)?:\/\/(www\.)?([^\/\?#]+)[\/\?#]*/.exec(url);
  return match ? match[3] : null;
};

exports.parsePageNum = function(url){
	var baseUrl = getBaseUrl(url);
  console.log("hi in parse page for base: " + baseUrl)
  var result = undefined
  var callback = function(res){result = res;}
  Webpage.find({url: baseUrl}, function (err, pages) {
    if (!err && pages.length != 0) {
      console.log("in else with url: " + url)
      var pattern = pages[0].pgQueryParam + "=" + "([0-9]+)";
      var match = url.match(new RegExp(pattern));
      console.log("match 1 is: " + match[1])
      callback(match ? match[1] : undefined)
    }
  });
  console.log("res out here is: " + result)
  return result;
}

exports.sanitizeUrl = function(url){
  var match = /^(http(s)?:\/\/[^\?#]+)[\?#]*/.exec(url);
  console.log("match is:" + match);
  return match ? match[1] : null;
}
